<!-- This is the HTML for editing the user profile -->
{% extends 'base.html' %}

<!-- these provide the tab titles on the browser -->
{% block title %}
	Update Profile | {{ block.super }}
{% endblock title %}

{% block content %}
<div class='row'>
	<!-- centers the content -->
	<div class='col-sm-8 offset-sm-2 mt-3'>
		<!-- brings in the create/update form -->
		{% load crispy_forms_tags %}

		<h2 class="mt-3">Profile Settings</h2><hr>

		<form class='form mt-2' method='POST' action='' enctype="multipart/form-data">
			{% csrf_token %}
			<!-- the view itself tells us which form to insert, so it's 
			not actually specified -->
		    {{ form|crispy }}
		    <input class='btn btn-primary-new' type="submit" value='Save Changes' />
		</form>
	</div>

	<!-- INTEGRATION SECTION -->
	<div class='col-sm-8 offset-sm-2 mt-5'>
		<h2 class="mt-3">Integrations</h2><hr>

		<!-- twitch auth section -->
		<h4 class='mt-3'>Twitch</h4>
		{% if request.user.profile.twitch_id == '' %}
			<a href='https://api.twitch.tv/kraken/oauth2/authorize?response_type=code&client_id={{twitch_client_id}}&redirect_uri={{twitch_redirect_uri}}&scope=channel_subscriptions+user_read+channel_check_subscription'>
				<button class="btn btn-primary-new">Connect your Twitch account!</button>
			</a>
		{% else %}
			<a data-toggle="modal" id="TwitchDisconnectButton" data-target="#TwitchDisconnectModal">
				<button class="btn btn-primary-new">Disconnect your Twitch account</button>
			</a>
			<div class="modal fade" id="TwitchDisconnectModal" tabindex="-1" role="dialog" aria-labelledby="TwitchDisconnectModalTitle" aria-hidden="true">
			  	<div class="modal-dialog modal-dialog-centered" role="document">
			    	<div class="modal-content">
			      		<div class="modal-header">
			        		<h5 class="modal-title" id="TwitchDisconnectModalTitle">Disconnect Twitch?</h5>
			        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          			<span aria-hidden="true">&times;</span>
			        		</button>
			      		</div>
			      		<div class="modal-body text-left">
			      			Disconnecting your Twitch account prevents you from participating in any Twitch enabled events.
			      		</div>
			      		<div class="modal-footer">
			        		<a class="btn btn-outline-danger btn-block" id="modalTwitchDisconnectButton" href='{{ request.user.profile.get_twitch_reset_url }}'>
			        			Disconnect
			    			</a>
			      		</div>
			    	</div>
			  	</div>
			</div>
		{% endif %}

		<!-- streamlabs auth section -->
		<h4 class='mt-4'>Streamlabs</h4>
		{% if request.user.profile.streamlabs_access_token == '' %}
			<a href='https://streamlabs.com/api/v1.0/authorize?response_type=code&client_id={{streamlabs_client_id}}&redirect_uri={{streamlabs_redirect_uri}}&scope=alerts.create'>
				<button class="btn btn-primary-new mb-3">Connect your Streamlabs account!</button>
			</a>
		{% else %}
			<a data-toggle="modal" id="StreamlabsDisconnectButton" data-target="#StreamlabsDisconnectModal">
				<button class="btn btn-primary-new mb-3">Disconnect your Streamlabs account</button>
			</a>
			<div class="modal fade" id="StreamlabsDisconnectModal" tabindex="-1" role="dialog" aria-labelledby="StreamlabsDisconnectModalTitle" aria-hidden="true">
			  	<div class="modal-dialog modal-dialog-centered" role="document">
			    	<div class="modal-content">
			      		<div class="modal-header">
			        		<h5 class="modal-title" id="StreamlabsDisconnectModalTitle">Disconnect Streamlabs?</h5>
			        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          			<span aria-hidden="true">&times;</span>
			        		</button>
			      		</div>
			      		<div class="modal-body text-left">
			      			Disconnecting your Streamlabs account prevents purchase notifications from displaying on your stream. 
			      		</div>
			      		<div class="modal-footer">
			        		<a class="btn btn-outline-danger btn-block" id="modalStreamlabsDisconnectButton" href='{{ request.user.profile.get_streamlabs_reset_url }}'>
			        			Disconnect
			    			</a>
			      		</div>
			    	</div>
			  	</div>
			</div>
		{% endif %}
	</div>


	<!-- REFERRALS SECTION -->
	<div class='col-sm-8 offset-sm-2 mt-5'>
		<h2 class="mt-3">Referrals</h2><hr>

		<!-- referral link -->
		<h4 class='mt-3'>Your Link</h4>
		<p>https://www.granite.gg/register/?ref={{ object.user.username }}</p>

		<!-- Referees -->
		<h4 class='mt-3'>Your Referrals</h4>
		{% if object.referred_list.length != 0 %}
			{% for referred_user in object.referred_list %}
				<p>{{ referred_user.username }}</p>
			{% endfor %}
		{% else %}
			<p>You have not referred any users.</p>
		{% endif %}
	</div>

</div>
{% endblock content %}